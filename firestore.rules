rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ============================================
    // PRODUCTS COLLECTION - Public read, admin write
    // ============================================
    match /products/{productId} {
      // Allow anyone to read products (for website display)
      allow read: if true;
      
      // Only allow authenticated admins to create/update/delete products
      allow write: if request.auth != null && isAdmin();
    }
    
    // ============================================
    // SETTINGS COLLECTION - Public read, admin write
    // ============================================
    match /settings/{settingsId} {
      // Allow anyone to read settings (for website display)
      allow read: if true;
      
      // Only allow authenticated admins to create/update/delete settings
      allow write: if request.auth != null && isAdmin();
    }
    
    // ============================================
    // THEMES COLLECTION - Public read, admin write
    // ============================================
    match /themes/{themeId} {
      // Allow anyone to read themes (for website display)
      allow read: if true;
      
      // Only allow authenticated admins to create/update/delete themes
      allow write: if request.auth != null && isAdmin();
    }
    
    // ============================================
    // ADMIN USERS COLLECTION - For managing admin access
    // ============================================
    match /admins/{adminId} {
      // Only admins can read/write admin list
      allow read, write: if request.auth != null && isAdmin();
    }
    
    // ============================================
    // HELPER FUNCTIONS
    // ============================================
    
    // Check if the authenticated user is an admin
    // This function checks if the user's email is in the admins collection
    function isAdmin() {
      return exists(/databases/$(database)/documents/admins/$(request.auth.token.email));
    }
  }
}